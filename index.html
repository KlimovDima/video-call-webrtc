<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>üé• –í–∏–¥–µ–æ—Å–≤—è–∑—å</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      text-align: center;
      margin: 20px;
      background: #f0f2f5;
    }
    h1 { color: #1a73e8; }
    p { color: #555; }
    #video-container {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 20px;
      flex-wrap: wrap;
    }
    video {
      width: 400px;
      height: 300px;
      border: 1px solid #ddd;
      border-radius: 12px;
      background: #000;
      object-fit: cover;
    }
    #connect-btn {
      padding: 12px 28px;
      font-size: 16px;
      background-color: #1a73e8;
      color: white;
      border: none;
      border-radius: 24px;
      cursor: pointer;
      margin: 15px 0;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    #connect-btn:hover { background-color: #1557b0; }
    #connect-btn:disabled { background-color: #ccc; cursor: not-allowed; }
    #status {
      margin: 10px 0;
      font-weight: 500;
      color: #d9534f;
    }
    @media (max-width: 768px) {
      video { width: 90vw; height: 60vw; }
    }
  </style>
</head>
<body>

  <h1>üé• –î–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω—è—è –≤–∏–¥–µ–æ—Å–≤—è–∑—å</h1>
  <p>–ü–æ–¥–µ–ª–∏—Ç–µ—Å—å —Å—Å—ã–ª–∫–æ–π —Å –¥—Ä—É–≥–æ–º ‚Äî –∏ –Ω–∞—á–Ω–∏—Ç–µ –æ–±—â–µ–Ω–∏–µ –ø–æ –≤–∏–¥–µ–æ!</p>
  
  <button id="connect-btn" disabled>üìû –ù–∞—á–∞—Ç—å –≤–∏–¥–µ–æ—Å–≤—è–∑—å</button>
  <div id="status">–ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ –∏ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É...</div>

  <div id="video-container">
    <div>
      <h3>–í—ã</h3>
      <video id="local-video" autoplay muted></video>
    </div>
    <div>
      <h3>–°–æ–±–µ—Å–µ–¥–Ω–∏–∫</h3>
      <video id="remote-video" autoplay></video>
    </div>
  </div>

  <!-- Socket.IO –∫–ª–∏–µ–Ω—Ç -->
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <script>
    // üîÅ –ó–ê–ú–ï–ù–ò –ù–ê –°–í–û–ô –ê–î–†–ï–° –° GLITCH!
    const SOCKET_SERVER_URL = "https://your-project-name.glitch.me";
    const ROOM_NAME = "default-room";

    const localVideo = document.getElementById('local-video');
    const remoteVideo = document.getElementById('remote-video');
    const connectBtn = document.getElementById('connect-btn');
    const statusText = document.getElementById('status');

    let localStream = null;
    let peerConnection = null;
    let socket = null;

    const iceConfig = { iceServers: [{ urls: 'stun:stun.l.google.com:19302' }] };

    // –ó–∞–ø—Ä–æ—Å –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ
    async function initMedia() {
      try {
        localStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
        localVideo.srcObject = localStream;
        statusText.textContent = "‚úÖ –ö–∞–º–µ—Ä–∞ –≥–æ—Ç–æ–≤–∞. –ù–∞–∂–º–∏—Ç–µ '–ù–∞—á–∞—Ç—å –≤–∏–¥–µ–æ—Å–≤—è–∑—å'";
        connectBtn.disabled = false;
      } catch (err) {
        statusText.textContent = "‚ùå –û—à–∏–±–∫–∞ –∫–∞–º–µ—Ä—ã: " + err.message;
        console.error("–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –º–µ–¥–∏–∞:", err);
      }
    }

    // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫—É
    function startCall() {
      connectBtn.disabled = true;
      statusText.textContent = "üîç –ü–æ–∏—Å–∫ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞...";

      socket = io(SOCKET_SERVER_URL);
      socket.emit('join-room', ROOM_NAME);

      socket.on('user-connected', () => {
        createPeerConnection();
        isInitiator = true;
        makeOffer();
      });

      socket.on('offer', async (data) => {
        if (!peerConnection) createPeerConnection();
        await peerConnection.setRemoteDescription(new RTCSessionDescription(data.sdp));
        const answer = await peerConnection.createAnswer();
        await peerConnection.setLocalDescription(answer);
        socket.emit('answer', { sdp: answer, room: ROOM_NAME });
      });

      socket.on('answer', async (data) => {
        await peerConnection.setRemoteDescription(new RTCSessionDescription(data.sdp));
      });

      socket.on('ice-candidate', async (data) => {
        if (peerConnection) {
          await peerConnection.addIceCandidate(new RTCIceCandidate(data.candidate));
        }
      });

      socket.on('user-disconnected', () => {
        statusText.textContent = "üßë‚Äçü§ù‚Äçüßë –°–æ–±–µ—Å–µ–¥–Ω–∏–∫ –æ—Ç–∫–ª—é—á–∏–ª—Å—è.";
        if (peerConnection) peerConnection.close();
        peerConnection = null;
      });
    }

    function createPeerConnection() {
      peerConnection = new RTCPeerConnection(iceConfig);
      localStream.getTracks().forEach(track => peerConnection.addTrack(track, localStream));

      peerConnection.ontrack = (event) => {
        remoteVideo.srcObject = event.streams[0];
        statusText.textContent = "üü¢ –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ!";
      };

      peerConnection.onicecandidate = (event) => {
        if (event.candidate) {
          socket.emit('ice-candidate', { candidate: event.candidate, room: ROOM_NAME });
        }
      };
    }

    async function makeOffer() {
      const offer = await peerConnection.createOffer();
      await peerConnection.setLocalDescription(offer);
      socket.emit('offer', { sdp: offer, room: ROOM_NAME });
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
    connectBtn.addEventListener('click', startCall);
    initMedia();
  </script>
</body>
</html>
